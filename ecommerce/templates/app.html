{% load staticfiles %}
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css"
          integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css"
          integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/app.css' %}"/>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"/>
    <!-- <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBwx5OAOJROz6qwNrGnP-eRRAQSmyxklA8&callback=initMap" async defer</script></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OverlappingMarkerSpiderfier/1.0.3/oms.min.js"></script>
</head>
<body>

<div id="parentScr" class="row">

    <div class="col-md-12" style="margin:0;padding:0px;border:0px;">

        <div class="paper nav-fixed">
            OmoAds
            <button class="btn btn-share" id="share-button"><i class="fas fa-share-alt"></i></button>
        </div>
        <br><br>

        <!-- app view-->
        <div id="app-view">
            <div class="info-bar-small">
                <i style="float:left;margin-left:1em;margin-top:5px;" class="fas fa-times"></i>
                <p style="float:left;margin-left:1em;">{{agency_name}}</p>
                <!--<i style="float:left;margin-left:1em;margin-top:5px;"class="fas fa-info-circle"></i>-->
                <br>
                <hr width="100%"/>
                <i style="float:left;margin-left:calc(100% - 100px);margin-top:5px;" class="fas fa-chevron-left"></i>
                <i style="float:left;margin-left:1em;margin-top:5px;" class="fas fa-chevron-right"></i>
            </div>
            <div class="vr-container">

                <div class="swip__card" id='swip-card2'>
                    <div class="vr" id='vrview-2' active-view-id="0"></div>
                    <img id="image-2"
                         style="max-width: 100%;margin-left: auto;margin-right: auto;padding: 0;width:auto;height:80%;display:block;"
                         src="">
                    <div class="info-block" state="open">
                        <h5><span id="landmark-2"></span></h5>
                        <ul style="list-style: none;text-align: left;font-size: 12px;">
                            <li style="display:inline;margin-left:2em;"><b>Pole ID :</b><span id="pole-id-2"></span>
                            </li>
                            <li style="display:inline;margin-left:2em;"><b>Dimensions :</b><span
                                    id="dimension-2"></span></li>
                            <li style="display:inline;margin-left:2em;"><b>Type :</b><span id="type-2"></span></li>
                            <br>
                            <li style="display:inline;margin-left:2em;"><b>Lighted :</b><span id="lighted-2"></span>
                            </li>
                            <li style="display:inline;margin-left:2em;"><b>Facing :</b><span id="facing-2"></span></li>
                            <li style="display:inline;margin-left:2em;"><b>Zone:</b><span id="zone-2"></span></li>
                        </ul>
                        <a href="#"><i class="fas fa-map-marker-alt fa fa-2x"></i></a>
                        <button class="btn btn-avail" id="avail">Check Availibilty</button>
                    </div>
                </div>

                <div class="swip__card" id='swip-card1'>
                    <div class="vr" id='vrview-1' active-view-id="1" style="background:#FF945A;" style="display: none;">
                    </div>
                    <img id="image-1"
                         style="max-width: 100%;margin-left: auto;margin-right: auto;padding: 0;width:auto;height:80%;display:block;"
                         src="https://omodep.s3.amazonaws.com/static/boardimages/5.jpg">
                    <div class="info-block" state="open">
                        <h5><span id="landmark-1"></span></h5>
                        <ul style="list-style: none;text-align: left;font-size: 12px;">
                            <li style="display:inline;margin-left:2em;"><b>Pole ID :</b><span id="pole-id-1"></span>
                            </li>
                            <li style="display:inline;margin-left:2em;"><b>Dimensions :</b><span
                                    id="dimension-1"></span></li>
                            <li style="display:inline;margin-left:2em;"><b>Type :</b><span id="type-1"></span></li>
                            <br>
                            <li style="display:inline;margin-left:2em;"><b>Lighted :</b><span id="lighted-1"></span>
                            </li>
                            <li style="display:inline;margin-left:2em;"><b>Facing :</b><span id="facing-1"></span></li>
                            <li style="display:inline;margin-left:2em;"><b>Zone:</b><span id="zone-1"></span></li>
                        </ul>
                        <a href="#"><i class="fas fa-map-marker-alt fa fa-2x"></i></a>
                        <button class="btn btn-avail" id="avail">Check Availibilty</button>
                    </div>
                </div>
            </div>
        </div><!-- app view-->
        <div class="static-btn">
            <button class="btn btn-left"><i class="fas fa-chevron-left"></i></button>
            <button class="btn btn-start"></button>
            <button class="btn btn-right"><i class="fas fa-chevron-right"></i></button>
            
        </div>

    </div>
</div>

            <div class="kw-model" id="share">

                <div class="kw-model-dialog">

                    <p class="btn kw-model-close">x<p>

                        <div class="kw-model-body">
                            <div class="row justify-content-center">
                                <div class="col-md-12">
                                    <h3>Availibilty</h3>

                                </div>
                            </div>
                            <ul class="list-group">
                                <li class="list-group-item">BillBoard 1
                                    <div class="progress" id="progress-date">
                                        <!-- use loop here to genrate-->
                                        <!--<div booking-start="s-date" booking-end="e-date" price="234"-->
                                        <!--status="true" class="progress-bar bg-info" role="progressbar"-->
                                        <!--style="width: 20.00%;" aria-valuenow="18.89" aria-valuemin="0"-->
                                        <!--aria-valuemax="100"></div>-->
                                        <!--<div id="period13" booking-start="s-date" booking-end="e-date" price="234"-->
                                        <!--status="true" class="progress-bar bg-info" role="progressbar"-->
                                        <!--style="width: 80.00%" aria-valuenow="18.89" aria-valuemin="0"-->
                                        <!--aria-valuemax="100"></div>-->
                                    </div>
                                </li>

                            </ul>
                            <br>
                            <div class="kw-popOver">
                                <p>Start : <span id="s-date"></span> | end : <span id="e-date"></span><br>
                                    <span id="status"></span></p>
                            </div>
                            <br>
                        </div>
                </div>
            </div>
        </div>
        
    </div>
</div>
<div id="fullMap" style="width: 100%; height: 100%; background-color: #ff6c00; flex: 1 1 auto; overflow: auto; "></div>
</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"
        integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
        crossorigin="anonymous"></script>
<script src="https://storage.googleapis.com/vrview/2.0/build/vrview.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/swing/3.0.2/swing.js"></script>
<script src="https://hammerjs.github.io/dist/hammer.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBwx5OAOJROz6qwNrGnP-eRRAQSmyxklA8&callback=initMap" async defer</script></script>

<script>
    /*
    // https://github.com/gajus/swing
    var myElement = document.getElementById('swip-card');

    // create a simple instance
    // by default, it only adds horizontal recognizers
    var mc = new Hammer(myElement);

    // listen to events...
    //panleft panright tap press
    mc.on("panleft panright tap press swip", function(ev) {
        //var direction = e.gesture.direction;

        //myElement.textContent = ev.type;

        if(ev.type == 'tap'){
            $("#swip-card").css("background","#ff0000");
            $("#swip-card").addClass("animated bounce");
            $('.info-block').toggle();

        }
        if(ev.type == 'panleft'){
            $("#swip-card").css("background","#00ff00");
            $("#swip-card").addClass("to-left");
            //$('.info-block').hide();
        }
        if(ev.type == 'panright'){
            $("#swip-card").css("background","#0000ff");
            $("#swip-card").addClass("to-right");
            //$('.info-block').hide();
        }

    });
    */
    //window.addEventListener('load', onVrViewLoad);

    var url = "https://cdn1.360cities.net/pano/senord/01458239_key_biscayne.jpg/equirect_crop_3_1/6.jpg";


    // Selector '#vrview' finds element with id 'vrview'.
    // var vrView = new VRView.Player('#vrview1', {
    //   image: url,
    //   preview: 'https://cdn1.360cities.net/pano/senord/01458239_key_biscayne.jpg/equirect_crop_3_1/6.jpg',
    //   is_debug: false,
    //   width: '100%',
    //   height: '350',
    //   //is_stereo: true
    //   is_vr_off: false
    // });

    function loadScene(id) {
        console.log('loadScene', id);

        // Set the image
        vrView.setContent({
            image: dataObject.view_data[parseInt(id)].url,
            preview: dataObject.view_data[parseInt(id)].url,
            is_stereo: false,
            is_autopan_off: true
        });
    }

    //onVrViewLoad(url);

    var data = `{
	"view_data":[

			{"viewId":1,
			 "url" : "https://cdn1.360cities.net/pano/senord/01458239_key_biscayne.jpg/equirect_crop_3_1/6.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			},
			{"viewId":2,
			 "url" : "https://cdn.eso.org/images/screen/hqe-pano1.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			},
			{"viewId":3,
			 "url" : "https://omos.s3.amazonaws.com/img/images/Glen-Beach-Panorama-Google-4096x2048.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			},
			{"viewId":4,
			 "url" : "http://www.stockhamster.com/images/26866.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			},
			{"viewId":5,
			 "url" : "https://omos.s3.amazonaws.com/img/images/Glen-Beach-Panorama-Google-4096x2048.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			},
			{"viewId":6,
			 "url" : "https://img1.cgtrader.com/items/929693/756fdb023a/hdri-industrial-warehouse-interior-8-3d-model-low-poly.jpg",
			 "info":"Lorem ipsum dolor sit amet consectetur adipisicing elit. Deleniti eveniet rem totam asperiores molestiae, magnam minus tempore veniam voluptas autem."

			}


	]


}`;

    var dataObject = JSON.parse(data);
    var MAX = dataObject.view_data.length;

    console.log(MAX);
    $("[id=open-full]").on("click", function () {
        var viewId = $(this).attr("view-id");
        //var url = $(this).attr("url");
        $(".img-block-container").hide(0);
        $("#app-view").show(100);
        $("#vrview1").attr("active-view-id", viewId);
        //console.log(viewId);
    });

    $(".btn-more").on("click", function () {

        var state = $("#btn-more-icon").attr("state");
        if (state == "up") {
            $("#btn-more-icon").removeClass("fa-chevron-up");
            $("#btn-more-icon").addClass("fa-chevron-down");
            $("#btn-more-icon").attr("state", "down");
            $(".gallay-wrapper").css("top", "100px");
            $(".gallay-wrapper").css("height", "700px");
        }
        else {
            $("#btn-more-icon").removeClass("fa-chevron-down");
            $("#btn-more-icon").addClass("fa-chevron-up");
            $("#btn-more-icon").attr("state", "up");
            $(".gallay-wrapper").css("top", "550px");
            $(".gallay-wrapper").css("height", "160px");
        }


    });
    $(".fa-info-circle").on("click", function () {

        var state = $(".info-block").attr("state");
        if (state == "open") {
            $(".info-block").hide(100);
            $(".info-block").attr("state", "close");
        }
        else {
            $(".info-block").show(100);
            $(".info-block").attr("state", "open");
        }

    });
    $(".fa-times").on("click", function () {
        $(".img-block-container").show(100);
        $("#app-view").hide(0);
    });
    $(".fa-chevron-left").on("click", function () {
        var viewId = $("#vrview").attr("active-view-id");

        if (parseInt(viewId) <= 1) {
            alert("This is the last");
        }
        else {
            //alert(viewId);
            $("#vrview").attr("active-view-id", parseInt(viewId) - 1);
            loadScene(parseInt(viewId) - 1);
        }
    });
    $(".fa-chevron-right").on("click", function () {
        var viewId = $("#vrview").attr("active-view-id");

        if (parseInt(viewId) >= MAX) {
            alert("This is the last");
        }
        else {
            //alert(viewId);
            $("#vrview").attr("active-view-id", parseInt(viewId) + 1);
            loadScene(parseInt(viewId) + 1);
        }

    });
    $(".kw-model-close").on("click", function () {

        $("#share").hide(100);
    });
    $(".kw-model").on("click", function () {
        //$("#share").hide(100);
    });
    // $(".progress-bar").hover(function () {
    //
    //     var s_date = $(this).attr("booking-date");
    //     var e_date = $(this).attr("booking-date");
    //     var price = $(this).attr("price");
    //     var status = $(this).attr("status");
    //     $(".kw-popOver").show(100);
    //     $("#s-date").html(s_date);
    //     $("#e-date").html(e_date);
    //     $("#price").html(price);
    //     if (status == 'true')
    //         $("#status").html("Booked");
    //     else
    //         $("#status").html("Not Booked");
    //
    // });
    // 5678-910711557

    $(document).ready(function () {
        $('#vrview-1').hide();
        $('#vrview-2').hide();
        $('#image-1').hide();
        $('#image-2').hide();
        $('#fullMap').hide();

        var jsonData = "{{banner_details}}";
        jsonData = jsonData.replace(/&#39;/g, '"');
        jsonData = JSON.parse(jsonData);
        var animating = false;
        var cardsCounter = 0;
        var anotherCardsCounter = 0;
        var numOfCards = jsonData.length;
        var decisionVal = 80;
        var pullDeltaX = 0;
        var deg = 0;
        var $card, $cardReject, $cardLike;
        var jsonDates = '';
        var flag_vr1 = 0;
        var flag_vr2 = 0;
        var vrView1 = '';
        var vrView2 = '';

        $(document).on("mouseenter", ".progress-bar", function () {
            var s_date = $(this).attr("booking-start");
            var e_date = $(this).attr("booking-end");
            var status = $(this).attr("status");
            console.log(s_date, e_date);
            $(".kw-popOver").show(100);
            $("#s-date").html(s_date);
            $("#e-date").html(e_date);
            if (status == 'true')
                $("#status").html("Booked");
            else
                $("#status").html("Not Booked");
        });

        $(document).on("mouseout", ".progress-bar", function () {
            $(".kw-popOver").hide(100);
        });

        if (jsonData.length === 1) {
            loadNextData();
            if (jsonData[0].url) {
                $('#vrview-1').show();
                vrView1 = new VRView.Player('#vrview-1', {
                    image: jsonData[0].url,
                    preview: jsonData[0].url,
                    is_debug: false,
                    width: '100%',
                    height: '350',
                    //is_stereo: true
                    is_vr_off: false
                });
            } else {
                $('#image-1').show();
                $('#image-1').attr('href', jsonData[0].normal_url)
            }
            $('#swip-card2').remove();
        }
        if (jsonData.length >= 2) {
            loadNextData();
            loadNextData();

            if (jsonData[0].url) {
                flag_vr1 = 1;
                $('#vrview-1').show();
                vrView1 = new VRView.Player('#vrview-1', {
                    image: jsonData[0].url,
                    preview: jsonData[0].url,
                    is_debug: false,
                    width: '100%',
                    height: '350',
                    //is_stereo: true
                    is_vr_off: false
                });
            } else {
                $('#image-1').show();
                $('#image-1').attr('href', jsonData[0].normal_url);
            }

            if (jsonData[1].url) {
                flag_vr2 = 1;
                $('#vrview-2').show()
                vrView2 = new VRView.Player('#vrview-2', {
                    image: jsonData[1].url,
                    preview: jsonData[1].url,
                    is_debug: false,
                    width: '100%',
                    height: '350',
                    //is_stereo: true
                    is_vr_off: false
                });
            } else {
                $('#image-2').show();
                $('#image-2').attr('href', jsonData[1].normal_url);
            }
        }

        function loadNextData() {
            var currentId = (cardsCounter % 2) + 1;
            if (cardsCounter < jsonData.length) {
                document.getElementById('pole-id-' + currentId).innerHTML = jsonData[cardsCounter].id;
                document.getElementById('dimension-' + currentId).innerHTML = jsonData[cardsCounter].dimension;
                document.getElementById('type-' + currentId).innerHTML = jsonData[cardsCounter].type;
                document.getElementById('lighted-' + currentId).innerHTML = jsonData[cardsCounter].lighted;
                document.getElementById('facing-' + currentId).innerHTML = jsonData[cardsCounter].facing;
                document.getElementById('zone-' + currentId).innerHTML = jsonData[cardsCounter].zone;
                document.getElementById('landmark-' + currentId).innerHTML = jsonData[cardsCounter].landmark;
                loadNextVRView(currentId);
                cardsCounter++;
            } else if (anotherCardsCounter + 2 === jsonData.length) {
                $('#swip-card' + currentId).remove();
            } else {
                $('#swip-card1').remove();
                $('#swip-card2').remove();
            }
        }

        function loadNextVRView(currentId) {
            console.log(cardsCounter);
            if (cardsCounter > 1) {
                console.log('Changing ...');
                if (currentId % 2 === 1) {
                    if (jsonData[cardsCounter].url) {
                        $('#image-1').hide();
                        $('#vrview-1').show();
                        console.log('Changed VR1: ', jsonData[cardsCounter].url);
                        if (flag_vr1 === 0) {
                            flag_vr1 = 1;
                            vrView1 = new VRView.Player('#vrview-1', {
                                image: jsonData[cardsCounter].url,
                                preview: jsonData[cardsCounter].url,
                                is_debug: false,
                                width: '100%',
                                height: '350',
                                //is_stereo: true
                                is_vr_off: false
                            });
                        } else {
                            vrView1.setContent({
                                image: jsonData[cardsCounter].url,
                                preview: jsonData[cardsCounter].url,
                                is_stereo: false,
                                is_autopan_off: true
                            });
                        }
                    } else {
                        $('#vrview-1').hide();
                        $('#image-1').show();
                        $('#image-1').attr('href', jsonData[cardsCounter].normal_url)
                    }
                } else {
                    if (jsonData[cardsCounter].url) {
                        $('#vrview-2').show();
                        $('#image-2').hide();
                        console.log('Changed VR2: ', jsonData[cardsCounter].url);
                        if (flag_vr2 === 0) {
                            flag_vr2 = 1;
                            vrView2 = new VRView.Player('#vrview-2', {
                                image: jsonData[cardsCounter].url,
                                preview: jsonData[cardsCounter].url,
                                is_debug: false,
                                width: '100%',
                                height: '350',
                                //is_stereo: true
                                is_vr_off: false
                            });
                        } else {
                            vrView2.setContent({
                                image: jsonData[cardsCounter].url,
                                preview: jsonData[cardsCounter].url,
                                is_stereo: false,
                                is_autopan_off: true
                            });
                        }
                    } else {
                        $('#vrview-2').hide();
                        $('#image-2').show();
                        $('#image-2').attr('href', jsonData[cardsCounter].normal_url)
                    }

                }
            }
        }

        $('#share-button').click(function () {
            console.log('YES');
            if (navigator.share) {
                navigator.share({
                    title: 'OMOAds',
                    text: 'Check out this',
                    url: window.location.href
                })
            } else {
                console.log('PC');
            }
        });

        function pullChange() {
            animating = true;
            deg = pullDeltaX / 10;
            $card.css("transform", "translateX(" + pullDeltaX + "px) rotate(" + deg + "deg)");
            var opacity = pullDeltaX / 100;
            var rejectOpacity = (opacity >= 0) ? 0 : Math.abs(opacity);
            var likeOpacity = (opacity <= 0) ? 0 : opacity;
            $cardReject.css("opacity", rejectOpacity);
            $cardLike.css("opacity", likeOpacity);
        }

        function release() {
            if (pullDeltaX >= decisionVal) {
                $card.addClass("to-right");
            } else if (pullDeltaX <= -decisionVal) {
                $card.addClass("to-left");
            }
            if (Math.abs(pullDeltaX) >= decisionVal) {
                $card.addClass("inactive");
                setTimeout(function () {
                    $card.addClass("below").removeClass("inactive to-left to-right");
                    loadNextData();
                    anotherCardsCounter++;
                    if (anotherCardsCounter % 2 === 0) {
                        console.log('Putting Card 2 below');
                        $("#swip-card1").removeClass("below");
                        $("#swip-card2").addClass("below");
                    } else {
                        console.log('Putting Card 1 below');
                        $("#swip-card2").removeClass("below");
                        $("#swip-card1").addClass("below");
                    }
                }, 300);
            }
            if (Math.abs(pullDeltaX) < decisionVal) {
                $card.addClass("reset");
            }
            setTimeout(function () {
                $card.attr("style", "").removeClass("reset")
                    .find(".swip__card__choice").attr("style", "");
                pullDeltaX = 0;
                animating = false;
            }, 300);
        }

        function getDayDifference(first, second) {
            return Math.round((new Date(second) - new Date(first)) / (1000 * 60 * 60 * 24));
        }

        function beautifyDate(today) {
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!

            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            return dd + '/' + mm + '/' + yyyy;
        }

        function getCardStatus() {
            $('#progress-date').empty();
            $.ajax({
                type: "POST",
                url: "{% url 'card_status' %}",

                beforeSend: function () {
                },
                global: true,
                data: {
                    "csrfmiddlewaretoken": "{{ csrf_token }}",
                    "id_point": String(jsonData[anotherCardsCounter].id)

                },
                success: function (data) {
                    console.log('YES');
                    console.log(data);
                    jsonDates = data['booking_dates'];
                    jsonDates = jsonDates.sort(function (a, b) {
                        // Turn your strings into dates, and then subtract them
                        // to get a value that is either negative, positive, or zero.
                        return new Date(a['startDate']) - new Date(b['startDate']);
                    });
                    var finalData = [];
                    console.log('jsonDates=', jsonDates);
                    if (jsonDates.length > 0) {
                        finalData.push({
                            'day': getDayDifference(new Date(new Date().getFullYear().toString()), jsonDates[0]['startDate']),
                            'status': 'inactive'
                        });
                    } else {
                        var snewDate = new Date(new Date().getFullYear().toString());
                        var enewDate = new Date((new Date().getFullYear() + 1).toString());
                        $('#progress-date').append('<div booking-start="' + beautifyDate(snewDate) + '" booking-end="' + beautifyDate(enewDate) + '" price="234"\n' +
                            'status="false" class="progress-bar bg-info" role="progressbar"\n' +
                            'style="width: 100%;background-color: grey !important" aria-valuenow="18.89" aria-valuemin="0"\n' +
                            'aria-valuemax="100"></div>')
                        return;
                    }
                    for (var i = 0; i < jsonDates.length; i++) {
                        finalData.push({
                            'day': getDayDifference(jsonDates[i]['startDate'], jsonDates[i]['endDate']),
                            'status': 'active'
                        });
                        if (jsonDates[i + 1]) {
                            finalData.push({
                                'day': getDayDifference(jsonDates[i]['endDate'], jsonDates[i + 1]['startDate']),
                                'status': 'inactive'
                            });
                        } else {
                            finalData.push({
                                'day': getDayDifference(jsonDates[i]['endDate'], new Date((new Date().getFullYear() + 1).toString())) - 2,
                                'status': 'inactive'
                            });
                        }
                    }
                    console.log(finalData);

                    var setTcolor = 'grey';
                    var sDate = beautifyDate(new Date(new Date().getFullYear().toString()));
                    var eDate = beautifyDate(new Date(jsonDates[0]['startDate']));
                    var price = '500';
                    var bookingStatus = 'false';
                    var sampleCounter = 0;
                    for (var i = 0; i < finalData.length; i++) {
                        console.log(finalData[i]['status']);
                        if (finalData[i]['status'] === 'active') {
                            setTcolor = 'red';
                            sDate = beautifyDate(new Date(jsonDates[sampleCounter]['startDate']));
                            eDate = beautifyDate(new Date(jsonDates[sampleCounter]['endDate']));
                            price = '500';
                            bookingStatus = 'true';
                            sampleCounter++;
                        } else {
                            bookingStatus = 'false';
                            setTcolor = 'grey';
                            if (i > 0) {
                                sDate = beautifyDate(new Date(jsonDates[sampleCounter - 1]['endDate']));
                                if (jsonDates.length > sampleCounter) {
                                    eDate = beautifyDate(new Date(jsonDates[sampleCounter]['startDate']));
                                } else {
                                    eDate = beautifyDate(new Date((new Date().getFullYear() + 1).toString()));
                                }
                                price = '500';
                            }
                        }
                        console.log('Final date\n', sDate, eDate);
                        $('#progress-date').append('<div booking-start="' + sDate + '" booking-end="' + eDate + '" price="' + price + '"\n' +
                            'status="' + bookingStatus + '" id = "' + i + '" class="progress-bar bg-info" role="progressbar"\n' +
                            'style="width: ' + (finalData[i]['day'] / 365) * 100 + '%;' + 'background-color: ' + setTcolor + '!important' + '" aria-valuenow="18.89" aria-valuemin="0"\n' +
                            'aria-valuemax="100"></div>')
                    }
                }
            });
        }

        $("[id=avail]").on("click", function () {
            $("#share").show(100);
            getCardStatus();
        });


        $(document).on("mousedown touchstart", ".swip__card:not(.inactive)", function (e) {
            var startY = e.pageY || e.originalEvent.touches[0].pageY;
            console.log(startY);
            if (startY > 460) {
                if (animating) return;
                $card = $(this);
                $cardReject = $(".swip__card__choice.m--reject", $card);
                $cardLike = $(".swip__card__choice.m--like", $card);
                var startX = e.pageX || e.originalEvent.touches[0].pageX;
                // card swip
                $(document).on("mousemove touchmove", function (e) {
                    var x = e.pageX || e.originalEvent.touches[0].pageX;
                    pullDeltaX = (x - startX);
                    if (!pullDeltaX) return;
                    pullChange();
                });
                $(document).on("mouseup touchend", function () {
                    $(document).off("mousemove touchmove mouseup touchend");
                    if (!pullDeltaX) return; // prevents from rapid click events
                    release();
                });
            }
        });

        function CenterControl(controlDiv, map) {

            // Set CSS for the control border.
            var controlUI = document.createElement('div');
            controlUI.style.backgroundColor = '#fff';
            controlUI.style.border = '2px solid #fff';
            controlUI.style.borderRadius = '3px';
            controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
            controlUI.style.cursor = 'pointer';
            controlUI.style.marginBottom = '22px';
            controlUI.style.textAlign = 'center';
            controlUI.title = 'Click to go back';
            controlDiv.appendChild(controlUI);

            // Set CSS for the control interior.
            var controlText = document.createElement('div');
            controlText.style.color = 'rgb(25,25,25)';
            controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
            controlText.style.fontSize = '16px';
            controlText.style.lineHeight = '38px';
            controlText.style.paddingLeft = '5px';
            controlText.style.paddingRight = '5px';
            controlText.innerHTML = 'GO BACK';
            controlUI.appendChild(controlText);

            // Setup the click event listeners: simply set the map to Chicago.
            controlUI.addEventListener('click', function() {
                $('#parentScr').show();
                $('#fullMap').hide();
            });

        }

        
        $('.fa-map-marker-alt').on("click", function(){
            //hide all divs for content visible
            $('#parentScr').hide();
            $('#fullMap').show();

            //initialize the map for the hidden div centered at the marker location
            var map = new google.maps.Map(document.getElementById('fullMap'), {
                center: {lat: parseFloat(jsonData[anotherCardsCounter].lat) , lng: parseFloat(jsonData[anotherCardsCounter].lng) },
                scrollwheel: true,
                fullscreenControl: false,
                gestureHandling: "greedy",
                streetViewControl: false,
                zoom: 15,
                mapTypeControl: false
            });

            //draw marker
            var marker = new google.maps.Marker({
                position: {lat: parseFloat(jsonData[anotherCardsCounter].lat) , lng: parseFloat(jsonData[anotherCardsCounter].lng) },
                icon: "{% static 'resources/images/marker3.png' %}",
                map: map
            });
            var oms = new OverlappingMarkerSpiderfier(map, {
                markersWontMove: true,
                markersWontHide: true,
                keepSpiderfied: true,
                basicFormatEvents: true
            });
            oms.addMarker(marker);
            
            // add back button on map
            var centerControlDiv = document.createElement('div');
            var centerControl = new CenterControl(centerControlDiv, map);
            centerControlDiv.index = 1;
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(centerControlDiv);

        });
        
    });

</script>
<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBwx5OAOJROz6qwNrGnP-eRRAQSmyxklA8&callback=initMap" async defer</script></script>




