{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
  

  <title>OmoAds</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="{% static 'css/nprogress.css' %}" rel="stylesheet" />
  <link href="{% static 'css/pace-theme-center-atom.css' %}" rel="stylesheet" />

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- <link rel="apple-touch-icon" sizes="57x57" href="{% static 'resources/images/favicon/apple-icon-57x57.png' %}">
  <link rel="apple-touch-icon" sizes="60x60" href="{% static 'resources/images/favicon/apple-icon-60x60.png' %}">
  <link rel="apple-touch-icon" sizes="72x72" href="{% static 'resources/images/favicon/apple-icon-72x72.png' %}">
  <link rel="apple-touch-icon" sizes="76x76" href="{% static 'resources/images/favicon/apple-icon-76x76.png' %}">
  <link rel="apple-touch-icon" sizes="114x114" href="{% static 'resources/images/favicon/apple-icon-114x114.png' %}">
  <link rel="apple-touch-icon" sizes="120x120" href="{% static 'resources/images/favicon/apple-icon-120x120.png' %}">
  <link rel="apple-touch-icon" sizes="144x144" href="{% static 'resources/images/favicon/apple-icon-144x144.png' %}">
  <link rel="apple-touch-icon" sizes="152x152" href="{% static 'resources/images/favicon/apple-icon-152x152.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'resources/images/favicon/apple-icon-180x180.png' %}">
  <link rel="icon" type="image/png" sizes="192x192"  href="{% static 'resources/images/favicon/android-icon-192x192.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'resources/images/favicon/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="96x96" href="{% static 'resources/images/favicon/favicon-96x96.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'resources/images/favicon/favicon-16x16.png' %}">
  <link rel="manifest" href="{% static 'resources/images/favicon/manifest.json' %}">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="{% static 'resources/images/favicon/ms-icon-144x144.png' %}">
  <meta name="theme-color" content="#ffffff">
 -->

 <!-- favicon -->
 <link rel="manifest" href="{% static 'resources/images/favicon/manifest.json' %}">
 <!-- <link href="https://fonts.googleapis.com/css?family=Raleway|Alegreya" rel="stylesheet"> -->
 
 <link rel="shortcut icon" sizes="16x16" type="image/ico" href="{% static 'resources/images/favicon/omo.ico' %}" />
 <link rel="icon" sizes="16x16" type="image/ico" href="{% static 'resources/images/favicon/omo.ico' %}" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OverlappingMarkerSpiderfier/1.0.3/oms.min.js"></script>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-105587377-1', 'auto');
    ga('send', 'pageview');

  </script>

  <!-- <script src="{% static 'js/landingPage.js' %}"></script> -->
  


  <link rel="stylesheet" href="{% static 'css/landingPage.css' %}">
  <script src="{% static 'js/nprogress.js' %}"></script>
  <script data-pace-options='{ "ajax": false }' src="{% static 'js/pace.js' %}"></script>
  
</head>

<style type="text/css">
  .bannerImage {
    background: black;
  }
  @keyframes fadeout {
    0%{opacity:0;top:50%}
    20%{opacity:1;}
    80%{opacity:1;top:50%;}
    100%{opacity:0;
      top:-50%;
    }

  }
  /* .cont{
    position: relative;
  } */
  /* .home-overlay, .blurred{
    display: flex;
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    flex-direction: column;
    justify-content: space-evenly;
    align-items: center;
    z-index: 99;
    background: radial-gradient(rgba(0,0,0,0.55), #000);
    color: #fff;
  }
  .home-hs{
    text-align: center;
    letter-spacing: 1px;
  }
  .home-hs h1{
    font-size: 3.7em;
    letter-spacing: 8px;
  }
  .home-hs h1, .home-hs h2{
    font-family: Raleway;
  }
  .home-features{
    display: flex;
    justify-content: space-evenly;
    align-items: flex-start;
    width: 100%;
  }
  .home-features .options{
    padding: 10px 5px;
    border-radius: 4px;
    width: 190px;
    text-align: center;
  }
  .options h3{
    font-size: 1.5em;
    margin: 10px 0 10px 0;
    font-family: Alegreya;
    letter-spacing: 1px;
  }
  .options img{
    height: 70px;
    width: 70px;
    border-radius: 50%;
    background-color: #fff;
  } */
  .home-overlay button{
    background-color: #ff6c00;
    color: #fff;
    border-radius: 5px;
    border: 0;
    transition: all 200ms ease;
    padding: 10px 15px;
    text-align: center;
    font-size: 1.3em;
  }
  .home-overlay button:hover{
    background-color: #fff;
    color: #ff6c00;
  }
  .blurred{
    background-color: #fff;
    z-index: 50;
    filter: blur(5px);
    background-image: url(https://user-images.githubusercontent.com/24919422/42364187-eec3d946-8117-11e8-9ea1-0f7600cf2970.PNG);
    background-size: cover;
    background-position: center;
  }
  .owner-details{
    text-align: right;
    margin-top: 0px;
    margin-right: 0px;
    padding-top: 0px;
    padding-bottom: 0px;
    font-size: 23px;
    display: inline-block;
  }
  #myModal .modal-footer .col-sm-8{
    display: flex;
    float: right;
    padding: 0;
    justify-content: space-between;

  }
  #myModal .modal-footer form{
    display: inline-block;
  }
  #message {
    position: absolute;
    z-index: 9999;
    top: -50%;
    left: 25%;
    right: 25%;
    background: #fde073;
    text-align: center;
    animation-name: fadeout;
    animation-duration: 2s;
    overflow: hidden;
    opacity:0;
    box-shadow: 0 0 5px black;

  }

  .view-cart{
    padding-right: 30px;
  }
  .view-cart .row{
    margin-left: 0px;
  }
  /* The switch - the box around the slider */
  .switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 22px;
  }

  /* Hide default HTML checkbox */
  .switch input {display:none;}

  /* The slider */
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }

  input:checked + .slider {
    background-color: #2196F3;
  }

  input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
  }

  input:checked + .slider:before {
    -webkit-transform: translateX(18px);
    -ms-transform: translateX(18px);
    transform: translateX(18px);
  }

  /* Rounded sliders */
  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }

</style>

<body>
<script type="text/javascript">
  Pace.start()

  </script>



{% if messages %}
    <div id="message">
{% for message in messages %}
   
<script type="text/javascript">
  if("{{message.extra_tags}}" == "wrong_credentials"){
    
    $(document).ready(function(){
      $('#loginModal').modal();
    });
  }
</script>

   <h3> {{ message }}</h3>
{% endfor %}
    </div>
{% endif %}

<section id = "sectionTry">
<script>
 
  $('#sectionTry').hide();
 
</script>
{% include 'navbar1.html' %}
  <!-- Login Modal -->
 
<div class="cont">

  <!-- <div class="home-overlay">
  
    <div class="home-hs">
      <h1>OMOADS</h1>
      <h2>Search, Connect and Rent</h2>
    </div>

    <div class="home-features">
      <div class="options">
        <img src="https://user-images.githubusercontent.com/30261658/42705332-9989fa94-86f0-11e8-95b1-a00310e93bf1.png" alt="Not Found" style="background-color: transparent;"/>
        <h3>0% Commision</h3>
      </div>
      <div class="options">
        <img src="https://user-images.githubusercontent.com/30261658/42703695-e48d0190-86ea-11e8-9e35-4ef3c206fcb8.png"/>
        <h3>Check availability</h3>
      </div>
      <div class="options">
        <img src="https://user-images.githubusercontent.com/24919422/42629007-8244064c-85ef-11e8-9597-f7eac559ce2d.png"/>
        <h3>Get geographic location</h3>
      </div>
    </div>

    <button class="home-inventory" value="Browser" onclick="hideHome()">Browse Inventory</button>
  </div>
  <div class="blurred"></div>
  <script>
    function hideHome(){
      document.querySelector('.home-overlay').style.display = 'none';
      document.querySelector('.blurred').style.display = 'none';
    }
  </script> -->

  <div class="container-fluid box">
    <div class="secondBox col-sm-10" >
      <input id="pac-input" class="controls" type="text" placeholder="Search Location">
      <div id="map" style="width: 100%; height: 100%; background-color: #ff6c00; flex: 1 1 auto; overflow: auto; "></div>
    </div>
    <div class="col-sm-2 filter">
    <form id="filterForm">
    
      <div class="sort">
        <h4 style="padding: 8px; margin: 0px;"><span class="glyphicon glyphicon-sort-by-attributes-alt" style="font-size: 14px;"></span>  Sort By</h4>
      </div>
      {% if user.is_authenticated %}
      <div class="card">
        <div class="filter-header">
          <h5>USER</h5>
        </div>
        <div class="check view-cart">
          
          <div class="checkbox">
            <div class="row">
              View Campaign
              <label class="switch pull-right">
                <input id="cart" name="user" onchange="submit_filter();" 
                type="checkbox" value="0">
                <span class="slider round"></span>
              </label>
            </div>
          </div>
          <!-- <div class="checkbox">
              <label>
                <input id="order" name="user" onchange="submit_filter();" 
                type="checkbox" value="0">ORDER
              </label>
          </div> -->
          
        </div>
      </div>
          {% endif %}
          <div class="card">
          <div class="filter-header">
            <h5>DIMENSIONS</h5>
          </div>
          <div class="check">
            {% for dimensions_of_banner in form.dimensions_banner %}
            <div class="checkbox">
              <label>
                {{  dimensions_of_banner }}
              </label>
            </div>
            {% endfor %}
          </div>
          </div>

          <div class="card">
            <div class="filter-header">
              <h5>TYPE</h5>
            </div>
            <div class="check">
              {% for type_of_banners in  form.type_banner %}
              <div class="checkbox">
                <label>
                  {{ type_of_banners }}
                </label>
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="card">
            <div class="filter-header">
              <h5>LIGHTED</h5>
            </div>
            <div class="check">
              {% for lights_of_banners in  form.lighted_banner %}
              <div class="checkbox">
                <label>
                  {{ lights_of_banners }}
                </label>
              </div>
              {% endfor %}
            </div>
          </div>
      </form>
    </div>
  </div>
</div>
<script type="text/javascript">
var submit_filter = function() {
  
  $.ajax({
           type: "POST",
           url: "{% url 'filter_form' %}",
           beforeSend: function(){
                                NProgress.start();
                               },
           data: {"filter_form": $("#filterForm").serialize(),
                  "csrfmiddlewaretoken": "{{ csrf_token }}",
                  },
           success: function(data)
           {
            for(let marker of markerGroup)
            {
              if(data["ids"].indexOf(marker.id_try)!==-1)
              {
                marker.setVisible(true)
              }
              else
              {
                marker.setVisible(false)
              }
                
            }
            markerCluster.repaint();
            NProgress.done();
                
           },
           error: function(data)
           {
              console.log("some error");
           },
         });   
}
</script>

<div class="footer"></div>
</section>

  <!-- Banner model -->
  <!-- Modal starts its magic -->

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
          <h3 class="modal-title" id="myModalLabel">Hapur Road, Near Hapur Chungi</h3>
        </div>

        
        <div class="modal-body">
          <!-- the content -->
          <div class="row">
            <div class="col-sm-4">
              <div class="panel panel-default">
                <div class="panel-heading">Banner Details</div>
                <div class="panel-body">
                  <p><strong>Pole ID:</strong> <span id="panelID">loading...</span></p>
                  <p><strong>Dimensions:</strong> <span id="dimensions">loading...</span></p>
                  <p><strong>Type:</strong> <span id="type">loading...</span></p>
                  <p><strong>Lighted:</strong> <span id="lighted">loading</span></p>
                  <p><strong>Facing:</strong> <span id="BannerFacing">Bus Station</span></p>
                  <p><strong>Zone:</strong> <span id="zone">Hapur Road</span></p>
                </div>
              </div>
              <div class="row date-input">
                <div class="col-sm-8 date-input-form">
                  <form>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                      <input id="datePicker" type="text" class="form-control" placeholder="Start Date">
                    </div>
                  </form>
                </div>
                <div class="col-sm-4 date-range-button">
                  <button class="btn btn-primary dropdown-toggle pull-right disabled" type="button" data-toggle="dropdown">Range
                  <span class="caret"></span></button>
                  <ul class="dropdown-menu" id="rangeSelector">
                    <li id="next30"><a href="#">Next 30 Days</a></li>
                    <li id="next45"><a href="#">Next 45 Days</a></li>
                    <li id="next60"><a href="#">Next 60 Days</a></li>
                    <li id="next90"><a href="#">Next 90 Days</a></li>
                    <li id="next120"><a href="#">Next 4 Months</a></li>
                    <li id="next150"><a href="#">Next 5 Months</a></li>
                    <li id="next180"><a href="#">Next 6 Months</a></li>
                  </ul>
                </div>
              </div>
              <div id="range-output" class="alert alert-danger"><em>Select start date and range</em></div>
              <div class="price-details">
                  <p>Price:<span class="pull-right" id="priceMyModal">&#8377; 00.00</span></p>
              </div>
              <div class="msg">
                <p><em>*(Select date and range to view price of banner)</em></p>
              </div>
              <!-- <div class="owner-details">
                <p>Owner Name: <span>Pole Ads</span></p>
                <p>Contact: <span>0123456789</span></p>
                <p>Email: <span>asd@qwe.zxc</span></p>
                <p>Office Add.: <span>Pole Ads</span></p>
              </div> -->
            </div>
            <div class="col-sm-8 right">
              <div>
                <img src="{% static 'resources/images/omoloader.gif' %}" id="bannerImage" class="img-thumbnail" alt="Banner Image">
              </div>

              <!-- The owner button div  -->
              

              

            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="col-sm-8">
            <div class="owner-details">
              <button class="btn btn-primary" id="own-det">About Owner</button>
            </div>
            <form method = "POST" action = "{% url 'addToCart' %}">
                      {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> 
                        <input type="hidden" name = "startDateAddCart" id="startDateAddCart" value = "">
                        <input type="hidden" name = "endDateAddCart" id="endDateAddCart" value = "">
                        <input type="hidden" name = "bannerIDAddCart" id="bannerIDAddCart" value = "">
                        <button type="submit" class="btn btn-primary" id="MyModalAddCart">Add To Cart</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal omodal fade" id="ownerModal" tabindex="-1" role="dialog" aria-labelledby="Owner Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="ownerModal-close close" data-dismiss="omodal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
          <h3 class="modal-title" id="myModalLabel">Owner Details</h3>
        </div>
        <div class="modal-body">
          <p class="o_name">Owner Name: <span>Pole Ads</span></p>
          <p class="o_contact">Contact: <span>0123456789</span></p>
          <p class="o_email">Email: <span>asd@qwe.zxc</span></p>
          <p class="o_add">Office Add.: <span>Pole Ads</span></p>
          <div class="msg-custom">
            <p>* Click anywhere outside to close the dialog box</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>


<!-- banner modal script start -->
<script type="text/javascript">
$(function() {

    var startDate;

    $("#next30").on("click",function(){
      nextDays(30);
    });
    $("#next45").on("click",function(){
      nextDays(45);
    });
    $("#next60").on("click",function(){
      nextDays(60);
    });
    $("#next90").on("click",function(){
      nextDays(90);
    });
    $("#next120").on("click",function(){
      nextDays(120);
    });
    $("#next150").on("click",function(){
      nextDays(150);
    });
    $("#next180").on("click",function(){
      nextDays(180);
    });

    function nextDays(x){
      startDate = $('#datePicker').data('daterangepicker').startDate;
      end = moment(startDate).add(x-1, 'days');
      setDate(startDate,end,x-1);
    }

    function setDate(start,end,days){
      $('#datePicker').data('daterangepicker').setEndDate(end);
      $('#range-output').html(start.format('D MMMM, YYYY') + ' - ' + end.format('D MMMM, YYYY'));

      console.log(invalidDates);

      handleDateInput(start, end)
    }


    function handleDateInput(start, end)
    {
      console.log("handleDateInput");
                    var diff = end.diff(start, 'days')
                    console.log(diff)
                    
                    var flag = 0
                    for (var i = 0; i<invalidDates.length;i++)
                    {

                      if(invalidDates[i] >= start.format('YYYY-MM-DD') && invalidDates[i] <= end.format('YYYY-MM-DD'))
                      {
                        flag  = 1;
                      // $('.price-details p span').html("Date range has invalid dates.")
                      $('.msg p em').html('Date range has invalid dates.');
                      $('.msg p').css('color','red');
                      $('.msg p').css('font-size','14px');
                      $('#range-output').removeClass("alert-success");
                      $('#range-output').addClass("alert-danger");
                      $('#MyModalAddCart').attr("disabled", true)
                        break;
                      }
                    }
                    if(flag == 0)
                    {
                      $('#MyModalAddCart').attr("disabled", false)
                      $('#range-output').removeClass("alert-danger");
                      $('#range-output').addClass("alert-success");
                      $('.msg p em').html('Your Date Range is available but filling fast! Hurry!');
                      $('.msg p').css('color','green');
                      $('.msg p').css('font-size','14px');

                      // $(this).css("color", "green").fadeIn(500);
                      
                    
                      $.ajax({
                              type: "POST",
                              url: "{% url 'AjaxBannerPrice' %}",
                              beforeSend: function(){
                                // Handle the beforeSend event
                                console.log("working")
                                NProgress.start();
                               },
                               complete: function(){
                                 // Handle the complete event
                                 NProgress.done();
                               },
                              data: {
                               "csrfmiddlewaretoken": "{{ csrf_token }}",
                               "id_point":BoardIdForPrice,
                               "startDate":start.format('YYYY-MM-DD'),
                               "endDate":end.format('YYYY-MM-DD'),

                              },
                               success: function(data){
                                $('.price-details p span').html('&#8377; '+data["total"]);
                                $("#startDateAddCart").val(start.format('YYYY-MM-DD'))
                                $("#endDateAddCart").val(end.format('YYYY-MM-DD'))
                                $("#bannerIDAddCart").val(BoardIdForPrice)
                               },
                               error: function(){
                                alert("Error! Something wrong. Please try again later")
                                },
                      });

                    }
                    else
                    {

                    }
                    //invalidDates = [];
    }


});
</script>
<!-- banner modal script end -->


<script src="https://cdn.rawgit.com/googlemaps/v3-utility-library/master/markerclustererplus/src/markerclusterer.js"></script>


<script>

    function setOwnerDetails(ownerDetails){
        let modalBody = document.querySelector('#ownerModal .modal-body');
        modalBody.children[0].innerHTML = `Owner Name: <span>${ownerDetails.o_name}</span>`;
        modalBody.children[1].innerHTML = `Contact: <span>${ownerDetails.o_contact}</span>`;
        modalBody.children[2].innerHTML = `Email: <span>${ownerDetails.o_email}</span>`;
        modalBody.children[3].innerHTML = `Office Add.: <span>${ownerDetails.o_add}</span>`;
    }



      var markers_for_bounds
      
       // var locations =[ {lat: 28.6781518, lng: 77.4796894},
       //  {lat: 28.6769073, lng: 77.4728407},
       //  {lat: 28.6763699, lng: 77.4701333},
       //  {lat: 28.6750844, lng: 77.4616545},
       //  {lat: 28.6739048, lng: 77.4537548},
       //  {lat: 28.6734001, lng: 77.4504691},
       //  {lat: 28.6732442, lng: 77.4493948},
       //  {lat: 28.6729218, lng: 77.4474875},
       //  {lat: 28.6724855, lng: 77.4446118},
       //  {lat: 28.6723961, lng: 77.4439885},
       //  {lat: 28.6721728, lng: 77.4427322},
       //  {lat: 28.6720037, lng: 77.4416342},
       //  {lat: 28.6711971, lng: 77.4363777},
       //  {lat: 28.6709432, lng: 77.4354001},
       //  {lat: 28.6707214, lng: 77.4334270},
       //  {lat: 28.6695674, lng: 77.4265163},
       //  {lat: 28.6696689, lng: 77.4265052},
       //  {lat: 28.6733651, lng: 77.4430692},
       //  {lat: 28.6737519, lng: 77.4429944},
       //  {lat: 28.6740493, lng: 77.4429626},
       //  {lat: 28.6754751, lng: 77.4425713},
       //  {lat: 28.6676614, lng: 77.4290214},
       //  {lat: 28.6675485, lng: 77.4273665},
       //  {lat: 28.669957, lng: 77.431754},
       //  {lat: 28.668975, lng: 77.432054},
       //  {lat: 28.66819, lng: 77.432332},
       //  {lat: 28.666023, lng: 77.433521},
       //  {lat: 28.665319, lng: 77.433852},
       //  {lat: 28.664172, lng: 77.434386},
       //  {lat: 28.663109, lng: 77.434857},
       //  {lat: 28.662789, lng: 77.435217},
       //  {lat: 28.661489, lng: 77.435542},
       //  {lat: 28.659875, lng: 77.435756},
       //  {lat: 28.657659, lng: 77.434879},
       //  {lat: 28.6650903, lng: 77.455809},
       //  {lat: 28.6625591, lng: 77.4621732},
       //  {lat: 28.6624664, lng: 77.4621041},
       //  {lat: 28.662228, lng: 77.462863},
       //  {lat: 28.660013, lng: 77.465962},
       //  {lat: 28.6589961, lng: 77.4672889},
       //  {lat: 28.658889, lng: 77.4671946},
       //  {lat: 28.647186, lng: 77.44578},
       //  {lat: 28.647782, lng: 77.444806},
       //  {lat: 28.647887, lng: 77.444905},
       //  {lat: 28.649038, lng: 77.443181},
       //  {lat: 28.651482, lng: 77.43973},
       //  {lat: 28.653684, lng: 77.436644},
       //  {lat: 28.654753, lng: 77.435084},
       //  {lat: 28.655983, lng: 77.433325},
       //  {lat: 28.6568593, lng: 77.4321415},
       //  {lat: 28.6577404, lng: 77.430892},
       //  {lat: 28.6597278, lng: 77.4280974},
       //  {lat: 28.6706658, lng: 77.4149831},
       //  {lat: 28.6727632, lng: 77.4069683},
       //  {lat: 28.67312, lng: 77.4062585},
       //  {lat: 28.676807, lng: 77.3918759},
       //  {lat: 28.6784319, lng: 77.3865805},
       //  {lat: 28.6779715, lng: 77.3884973},
       //  {lat: 28.67755, lng: 77.3899839},
       //  {lat: 28.6743781, lng: 77.401846},
       //  {lat: 28.6738745, lng: 77.4037004},
       //  {lat: 28.67284, lng: 77.4074226},
       //  {lat: 28.672345, lng: 77.409681},
       //  {lat: 28.6721493, lng: 77.410478},
       //  {lat: 28.6718569, lng: 77.4114681},
       //  {lat: 28.675918, lng: 77.418503},
       //  {lat: 28.6770641, lng: 77.420316},
       //  {lat: 28.678621, lng: 77.422418},
       //  {lat: 28.6797252, lng: 77.4239189},
       //  {lat: 28.6808859, lng: 77.4252781},
       //  {lat: 28.683349, lng: 77.428079}
       //  ];
        
        var locations = [];
        var locID = [];
    //the above var location is javascript var and the below one comes from djago code.bad names. confusing. gotta change
    {% for location in locations %}
    locations.push({
      lat: {{ location.lat }},
      lng: {{ location.lng }},
      //id: {{ location.id }}
    });
    locID.push({{ location.id }});

    {% endfor %}
    function resetPriceInfo()
    {
      $('.msg p em').html('*(Select date and range to view price of banner)');
      $('.msg p').css('color','#a0a0a0');
      $('.msg p').css('font-size','12px');
      $('#range-output').html('Select range')
      $('#range-output .em').removeClass("alert-success");
      $('#range-output').addClass("alert-danger");
      $('.price-details p span').html('&#8377; '+0.00);
      
    }
    function resetInfo(){
      $('#panelID').text("loading...");
      $('#myModalLabel').text("loading...");
      $('#zone').text("loading...");
      $('#BannerFacing').text("loading...");
      $('#bannerImage').attr("src", "{% static 'resources/images/omoloader.gif' %}");
      $('#price').text("loading...");
      $('#MapLoc').text("loading...");
      $('#dimensions').text("loading...");
      $('#type').text("loading...");
      $('#lighted').text("loading...");
      resetPriceInfo();
      $('#range-output').html('Select start date and range')
    }


    function initMap() {
      
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 28.683349, lng: 77.428079 },
        scrollwheel: true,
        fullscreenControl: false,
        gestureHandling: "greedy",
        streetViewControl: false,
        zoom: 7
      });

      markerGroup = locations.map(function(location, i) {
        return new google.maps.Marker({
          position: location,

          title: "OMOADS Site",
          icon: "{% static 'resources/images/marker3.png' %}"

        });
      });
      var oms = new OverlappingMarkerSpiderfier(map, { 
        markersWontMove: true, 
        markersWontHide: true,
        keepSpiderfied: true,
        basicFormatEvents: true
      });
      markers_for_bounds = markerGroup;
      for (var i = 0; i < locations.length; i++) {
       markerGroup[i].id_try = locID[i];
       // console.log(String(markerGroup[i].position))
       markerGroup[i].addListener('spider_click', function() {
          // infowindow.setContent(this.content);
          // infowindow.open(map, this);
          $('#MyModalAddCart').attr("disabled", true);
          resetInfo();
          $.ajax({
            type: "POST",
            url: "{% url 'onclickMapPoints' %}",
            
             beforeSend: function(){
              // Handle the beforeSend event
              resetInfo();
              // console.log("working")
              NProgress.start();
             },
             complete: function(){
               // Handle the complete event
               $('#bannerImage').on('load', function(){
                console.log("stop")
                NProgress.done();
               })
               
             },
            global: true,
            data: {
             "csrfmiddlewaretoken": "{{ csrf_token }}",
             "id_point":String(this.id_try)

           },
            success: function(data){
             
              $('#panelID').text(data["id"]);
              $('#bannerImage').attr("src", "{{MEDIA_URL}}" + data["url"]);
              $('#myModalLabel').text(data["landmark"]);
              $('#zone').text(data["zone"]);
              $('#BannerFacing').text(data["facing"]);
              $('#price').text(data["cost"]);
              $('#MapLoc').text(data["lat"] + " / " + data["long"]);
              $('#dimensions').text(data["dim"]);
              $('#type').text(data["type"]);
              $('#lighted').text(data["lighted"]);
              setOwnerDetails({'o_name':data["agency_name"], 'o_contact':data["agency_phone"],
                          'o_email':data["agency_email"], 'o_add':data["agency_address"]});
              
              var bookDates = data["bookDates"];
              BoardIdForPrice = (data["id"]);
              console.log(bookDates);
              invalidDates=[];
              for(var i = 0; i < bookDates.length; i++)
              {   //cd stands for current
                  var cd = moment(bookDates[i].startDate);
                  var ed = moment(bookDates[i].endDate);
                  while(cd.format('YYYY-MM-DD') <= ed.format('YYYY-MM-DD'))
                  {
                      invalidDates.push(cd.format('YYYY-MM-DD'))
                      cd.add(1, 'days')
                  }
              }
              // $('#landmark').text(data["landmark"])
              $('#myModal').attr("boardID",this.id_try)
              var ValidStartBooking =  moment().add(2, 'days');
              $('#datePicker').daterangepicker({
                  singleDatePicker: true,
                  showDropdowns: true,
                  minDate: ValidStartBooking,
                  ranges: {
                             'Next 15 Days': [ ValidStartBooking , moment().add(17, 'days')],
                             'Next 30 Days': [ ValidStartBooking , moment().add(32, 'days')],
                             'Next 45 Days': [ ValidStartBooking , moment().add(47, 'days')],
                             'Next 60 Days': [ ValidStartBooking , moment().add(62, 'days')],
                             'Next 75 Days': [ ValidStartBooking , moment().add(77, 'days')],
                             'Next 90 Days': [ ValidStartBooking , moment().add(92, 'days')],
                             'Next 105 Days': [ValidStartBooking, moment().add(107, 'days')],
                             'Next 120 Days': [ValidStartBooking, moment().add(122, 'days')]
                             // 'This Month': [moment().startOf('month'), moment().endOf('month')],
                             // 'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                          },
                    locale: {
                    format: 'DD/MM/YYYY'
                    },
                  seperator: 'To',
                  opens: "right",
                  drops: "up",
                  isInvalidDate: function(date)
                  {
                      

                      if (invalidDates.indexOf(date.format('YYYY-MM-DD'))!==-1)
                      {
                          return true; 
                      }
                      else
                      {
                          return false; 
                      }
                  }
                  },
                  function(start, end){
                    $('#MyModalAddCart').attr("disabled", true);
                    $(".date-range-button button").removeClass("disabled");
                    resetPriceInfo();
                    console.log("call back");
                    var diff = end.diff(start, 'days');
                    console.log(diff)
                    
                  },
               );
              },
              error: function(){
               alert("Error! Something wrong. Please try again later")
             },
           });



          $('#myModal').modal('show');
          });
       oms.addMarker(markerGroup[i]); 
     }
     $('#own-det').on('click', function(e){
       $('#ownerModal').modal('show');
     });
     $('.ownerModal-close').on('click', function(e){
      e.preventDefault();
      $('#ownerModal').modal('hide');
     });

     /*
      OwnerDetails is a JS object of the form:       
          {
            "o_name": String,
            "o_contact": String,
            "o_email": String,
            "o_add": String
          }
      */


     minClusterZoom = 17;


      markerCluster = new MarkerClusterer(map, markerGroup,
      {imagePath: "{% static 'js/m' %}", ignoreHidden: true});

     markerCluster.setMaxZoom(minClusterZoom);


     google.maps.event.addListener(markerCluster, 'clusterclick', function(cluster) {
            map.fitBounds(cluster.getBounds()); // Fit the bounds of the cluster clicked on
            if( map.getZoom() > minClusterZoom+1 ) // If zoomed in past 15 (first level without clustering), zoom out to 17
              map.setZoom(minClusterZoom+1);
          });


              // Create the search box and link it to the UI element.
              var input = document.getElementById('pac-input');
              var searchBox = new google.maps.places.SearchBox(input);
              //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
              // Bias the SearchBox results towards current map's viewport.
              map.addListener('bounds_changed', function() {
                searchBox.setBounds(map.getBounds());
              });
              var markers = [];
              // Listen for the event fired when the user selects a prediction and retrieve
              // more details for that place.
              searchBox.addListener('places_changed', function() {
                var places = searchBox.getPlaces();
                if (places.length == 0) {
                  return;
                }
                // Clear out the old markers.
                markers.forEach(function(marker) {
                  marker.setMap(null);
                });
                markers = [];
                // For each place, get the icon, name and location.
                var bounds = new google.maps.LatLngBounds();
                places.forEach(function(place) {
                  if (!place.geometry) {
                    console.log("Returned place contains no geometry");
                    return;
                  }
                  var icon = {
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                  };
                  // Create a marker for each place.
                  markers.push(new google.maps.Marker({
                    map: map,
                    icon: icon,
                    title: place.name,
                    position: place.geometry.location
                  }));
                  if (place.geometry.viewport) {
                    // Only geocodes have viewport.
                    bounds.union(place.geometry.viewport);
                  } else {
                    bounds.extend(place.geometry.location);
                  }
                });
                map.fitBounds(bounds);
              });
            }


            
</script>
<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBwx5OAOJROz6qwNrGnP-eRRAQSmyxklA8&callback=initMap" async defer</script>

<script type="text/javascript">
  // $('document').ready(initMap());  
</script>

<script type="text/javascript">

  function checkEmail(ele)
{ 
  var sub = document.getElementById("sub");
  var msg = document.getElementById("msg");
  var pass  =document.getElementById("id_password1")
  var username = document.getElementById("id_username")
  if(validateEmail(ele.value) == true)
  {
    msg.innerHTML = "VALID EMAIL";
    msg.style.color = "green";
    if(validateUserName(username.value)&&validatePassword(pass.value))
      sub.disabled = false;
    else
      sub.disabled = true;
  }
  else
  {
    msg.innerHTML = "INVALID EMAIL ID";
    msg.style.color = "red";
    sub.disabled = true;
    

  }
}
function checkUserName(ele)
{ 
  var sub = document.getElementById("sub");
  var msg = document.getElementById("msg2");
  var email = document.getElementById("id_email")
  var pass  =document.getElementById("id_password1")
  if(validateUserName(ele.value) == true)
  {
    msg.innerHTML = "VALID USERNAME";
    msg.style.color = "green";
    if(validateEmail(email.value)&&validatePassword(pass.value))
      sub.disabled = false;
    else
      sub.disabled = true;
  }
  else
  {
    msg.innerHTML = "INVALID USERNAME";
    msg.style.color = "red";
    sub.disabled = true;
  }
}

function password(ele)
{ 
  var sub = document.getElementById("sub");
  var msg = document.getElementById("passmsg");
 var username = document.getElementById("id_username")
 var email = document.getElementById("id_email")
  console.log(ele.value)
  if(validatePassword(ele.value) == true)
  {
    msg.innerHTML = "password accepted";
    msg.style.color = "green";
    if(validateEmail(email.value)&&validateUserName(username.value))
      sub.disabled = false;
    else
      sub.disabled = true;
  }
  else
  {
    msg.innerHTML = "atleast one number one capital and atleast 6 length";
    msg.style.color = "red";
    sub.disabled = true;
  }
}



function checkUserNameLogin(ele)
{ 
  var sub = document.getElementById("subLogin");
  var msg = document.getElementById("msg3");


  if(validateUserName(ele.value) == true || validateEmail(ele.value) == true)
  {
    msg.innerHTML = "VALID USERNAME";
    msg.style.color = "green";
    sub.disabled = false;

  }
  else
  {
    msg.innerHTML = "INVALID USERNAME";
    msg.style.color = "red";
    sub.disabled = true;
  }
}



function validateEmail(elementValue){        
   var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;  
   return emailPattern.test(elementValue);   
 }   
function validateUserName(elementValue){
   
     var UserNamePattern = /^[a-zA-Z0-9._-]{3,15}$/;  
     return UserNamePattern.test(elementValue); 
     
 }
 function validatePassword(elementValue){
   
     var passPattern = /^(?=.*[0-9])(?=.*[A-Z])[a-zA-Z0-9]{6,25}$/;  
     return passPattern.test(elementValue); 
     
 }
 var sub = document.getElementById("sub");
  var msg = document.getElementById("msg");
  sub.disabled = true;
  sub = document.getElementById("subLogin");
 sub.disabled = true;
  

</script>
<script type="text/javascript">
  $(window).on('load', function(){
  console.log("loaded")
  })
Pace.on("done", function(){
  $("#sectionTry").fadeIn(1000, function()
      {
          google.maps.event.trigger(map, 'resize');
          var bounds = new google.maps.LatLngBounds();
          for(var i = 0; i < markers_for_bounds.length; i++)
          {
            bounds.extend(markers_for_bounds[i].getPosition());
          }
          map.fitBounds(bounds);
      }); 
})
</script>
<script type="text/javascript">
    $(".nav-elements li:nth-child(1)").addClass("active");
  </script>
</html>